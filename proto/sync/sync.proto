syntax = "proto3";

package sync;

option go_package = "github.com/ava-labs/avalanchego/proto/pb/sync";

// For use in sync client, which has a restriction on the size of
// the response. GetChangeProof in the DB service doesn't.
message SyncGetChangeProofRequest {
  bytes start_root_hash = 1;
  bytes end_root_hash = 2;
  MaybeBytes start_key = 3;
  MaybeBytes end_key = 4;
  uint32 key_limit = 5;
  uint32 bytes_limit = 6;
}

message SyncGetChangeProofResponse {
  oneof response {
    bytes change_proof = 1;
    bytes range_proof = 2;
  }
}

// Range proof responses don't require any extra data, so no message is needed.
message SyncGetRangeProofRequest {
  bytes root_hash = 1;
  MaybeBytes start_key = 2;
  MaybeBytes end_key = 3;
  uint32 key_limit = 4;
  uint32 bytes_limit = 5;
}

message ChangeProof {
  repeated ProofNode start_proof = 1;
  repeated ProofNode end_proof = 2;
  repeated KeyChange key_changes = 3;
}

message RangeProof {
  repeated ProofNode start_proof = 1;
  repeated ProofNode end_proof = 2;
  repeated KeyValue key_values = 3;
}

message ProofNode {
  Key key = 1;
  MaybeBytes value_or_hash = 2;
  map<uint32, bytes> children = 3;
}

message KeyChange {
  bytes key = 1;
  MaybeBytes value = 2;
}

message Key {
  uint64 length = 1;
  bytes value = 2;
}

message MaybeBytes {
  bytes value = 1;
  // If false, this is None.
  // Otherwise this is Some.
  bool is_nothing = 2;
}

message KeyValue {
  bytes key = 1;
  bytes value = 2;
}
