#!/usr/bin/env bash

set -euo pipefail

if ! [[ "$0" =~ scripts/mock.gen.sh ]]; then
  echo "must be run from repository root"
  exit 255
fi

grep -lr -E '^// Code generated by MockGen\. DO NOT EDIT\.$' . | xargs -r rm

go generate -run "go.uber.org/mock/mockgen" ./...

git diff --exit-code

echo "SUCCESS"
