name: 'Setup AvalancheGo'
description: 'Setup AvalancheGo with custom dependencies (Firewood, Coreth, LibEVM)'

inputs:
  avalanchego:
    description: 'AvalancheGo version (commit SHA, branch name, or tag)'
    required: false
    default: ${{ github.sha }}
  firewood:
    description: 'Firewood version (commit SHA, branch, tag, or ffi/vX.Y.Z for pre-built)'
    required: false
    default: ''
  firewood-path:
    description: 'Directory path where Firewood will be cloned/built (preferably NVMe storage)'
    required: false
    default: ''
  coreth:
    description: 'Coreth version (commit SHA, branch name, or tag)'
    required: false
    default: ''
  libevm:
    description: 'LibEVM version (commit SHA, branch name, or tag)'
    required: false
    default: ''

runs:
  using: 'composite'
  steps:
    - name: Checkout AvalancheGo
      uses: actions/checkout@v4
      with:
        repository: 'ava-labs/avalanchego'
        ref: ${{ inputs.avalanchego }}
        path: ${{ inputs.checkout-path }}
    - name: Update Coreth dependency
      if: inputs.coreth != ''
      shell: bash
      working-directory: ${{ inputs.checkout-path }}
      run: |
        echo "Updating Coreth to version: ${{ inputs.coreth }}"
        go get github.com/ava-labs/coreth@${{ inputs.coreth }}
    - name: Update LibEVM dependency
      if: inputs.libevm != ''
      shell: bash
      working-directory: ${{ inputs.checkout-path }}
      run: |
        echo "Updating LibEVM to version: ${{ inputs.libevm }}"
        go get github.com/ava-labs/libevm@${{ inputs.libevm }}
    - name: Setup Firewood FFI
      if: inputs.firewood != ''
      shell: bash
      working-directory: ${{ inputs.checkout-path }}
      run: |
        if [ -n "${{ inputs.firewood-path }}" ]; then
          ./scripts/setup_firewood.sh ${{ inputs.firewood }} ${{ inputs.firewood-path }}
        else
          ./scripts/setup_firewood.sh ${{ inputs.firewood }}
        fi
